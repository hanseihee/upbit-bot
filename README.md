# Upbit Adaptive Grid Trading Bot

Upbit KRW 마켓 대상 **Adaptive Grid + Mean Reversion Hybrid** 자동매매 봇.
**1분봉 스캘핑** 전략으로 BTC 단일 운용에 최적화되었으며, **승률 70~85%** 를 목표로 설계되었다.

---

## 목차

1. [전략 개요](#전략-개요)
2. [프로젝트 구조](#프로젝트-구조)
3. [설치 및 환경 설정](#설치-및-환경-설정)
4. [실행 방법](#실행-방법)
5. [설정값 가이드](#설정값-가이드)
6. [아키텍처 상세](#아키텍처-상세)
7. [메인 루프 흐름](#메인-루프-흐름)
8. [백테스트](#백테스트)
9. [테스트](#테스트)
10. [로그 및 모니터링](#로그-및-모니터링)
11. [운영 가이드](#운영-가이드)
12. [업그레이드 로드맵](#업그레이드-로드맵)
13. [알려진 한계](#알려진-한계)

---

## 전략 개요

### 왜 Grid + Mean Reversion인가

| 전략 | 승률 | 리스크 | 소액 적합성 |
|------|------|--------|------------|
| **Grid Trading** | 70-85% | 낮음 | 최적 |
| Mean Reversion (BB+RSI) | 60-70% | 중간 | 좋음 |
| Momentum / Breakout | 40-55% | 높음 | 부적합 |

Grid Trading은 횡보장에서 높은 승률을 보이지만, 추세장에서는 손실이 크다.
Mean Reversion 필터를 결합하여 **진입 타이밍을 과매도 구간으로 제한**함으로써 추세 역행 리스크를 줄인다.

### 전략 흐름

```
코인 선별 → 진입 필터 → 그리드 생성 → 분할매수 → 자동매도 → 리스크 관리
```

**진입 조건** (모두 충족 시):
- RSI(14) < 30 (과매도)
- 가격 <= 볼린저 밴드 하단 (2σ)
- 현재 거래량 > 20일 평균 거래량
- MACD 히스토그램 상승 전환 (보강 조건)

**청산 조건** (하나라도 충족 시):
- 그리드 매도 레벨 도달 (정상 수익 실현)
- RSI(14) > 70 (과매수)
- 포지션 유지 2시간 초과
- 그리드 하단 -1.5% 손절가 도달
- 총자산 -10% 드로다운 (전체 청산)

### 그리드 동작 예시 (1분봉 기준)

```
현재가: 90,000,000원 / 1분 ATR: 75,000 / 간격 = ATR × 5.0 = 375,000

 매도 L1: 90,375,000  ←  L1 매수 체결 시 여기서 매도
 매도 L2: 90,000,000  ←  L2 매수 체결 시 여기서 매도
━━━━━━━━━━━━━━━━━━━━  현재가
 매수 L1: 89,625,000  ←  1차 매수
 매수 L2: 89,250,000  ←  2차 매수
 매수 L3: 88,875,000  ←  3차 매수
 매수 L4: 88,500,000  ←  4차 매수
━━━━━━━━━━━━━━━━━━━━
 손절가:  87,172,500   (L4 기준 -1.5%)
```

핵심: ATR(Average True Range)로 그리드 간격을 동적으로 조정한다.
- 1분봉 ATR ~75,000원, spacing 375,000원 (0.42%)
- 왕복 수수료(0.1%) 대비 **4.17배** 커버
- 변동성 높을 때 → 간격이 넓어져 안전 확보
- 변동성 낮을 때 → 간격이 좁아져 수익 기회 증가

---

## 프로젝트 구조

```
upbit-trading-bot/
├── config/
│   ├── settings.py          # 모든 설정값 (dataclass)
│   ├── .env                 # API 키 (gitignore)
│   └── .env.example         # 환경변수 템플릿
├── core/
│   ├── auth.py              # Upbit JWT 인증 (PyJWT)
│   ├── api_client.py        # REST API 클라이언트 (httpx, 비동기)
│   └── websocket_client.py  # WebSocket 실시간 데이터 (자동 재연결)
├── strategy/
│   ├── indicators.py        # 기술적 지표 (RSI, BB, ATR, MACD, ADX)
│   ├── signals.py           # 매매 신호 생성 + 신뢰도 계산 + 시장 체제 감지
│   ├── grid.py              # Adaptive Grid 생성/관리
│   ├── momentum.py          # 모멘텀 전략 (트레일링 스톱, 하드 손절)
│   └── coin_selector.py     # 자동 코인 선별 (스코어링)
├── trading/
│   ├── order_manager.py     # 주문 생성/추적/취소/체결 처리
│   ├── risk_manager.py      # 포지션사이징/손절/드로다운
│   └── portfolio.py         # 포트폴리오 잔고/포지션 조회
├── data/
│   ├── candle_fetcher.py    # 캔들 데이터 수집 + 메모리 캐싱
│   └── database.py          # SQLite (거래/포지션/그리드 기록)
├── utils/
│   ├── logger.py            # loguru 기반 (콘솔 + 파일 + 거래 전용)
│   └── notifier.py          # 알림 (콘솔, 텔레그램 확장 가능)
├── backtest/
│   ├── engine.py            # 백테스트 엔진 (수수료/손절 반영)
│   └── report.py            # 결과 리포트 출력
├── tests/
│   ├── test_indicators.py   # 지표 계산 테스트 (11개)
│   ├── test_grid.py         # 그리드 로직 테스트 (10개)
│   ├── test_risk_manager.py # 리스크 관리 테스트 (14개)
│   ├── test_backtest.py     # 백테스트 엔진 테스트 (7개)
│   └── test_momentum.py     # 모멘텀 전략 테스트 (20개)
├── logs/                    # 로그 파일 디렉토리
├── main.py                  # 봇 메인 진입점
├── requirements.txt         # Python 의존성
└── README.md                # 이 문서
```

### 모듈 의존성 방향

```
config ← core ← data ← strategy ← trading ← main.py
              ↖ utils (어디서든 참조)
```

순환 의존성 없이 단방향으로 설계되어 있다. `strategy`는 `core`를 직접 참조하지 않으며,
필요한 데이터는 `main.py`에서 주입한다.

---

## 설치 및 환경 설정

### 사전 요구사항

- Python 3.11 이상
- Upbit API 키 (Open API 발급: https://upbit.com/mypage/open_api_management)

### 1. 의존성 설치

```bash
cd upbit-trading-bot
pip install -r requirements.txt
```

**의존성 목록**:

| 패키지 | 용도 |
|--------|------|
| `httpx` | 비동기 HTTP 클라이언트 (Upbit REST API) |
| `websockets` | WebSocket 실시간 데이터 |
| `pandas` | 캔들 데이터 처리, 지표 계산 |
| `numpy` | 수치 연산 |
| `PyJWT` | Upbit API JWT 인증 토큰 생성 |
| `python-dotenv` | `.env` 파일에서 API 키 로드 |
| `loguru` | 구조화된 로깅 |
| `aiosqlite` | 비동기 SQLite (거래 기록) |
| `pytest` | 테스트 프레임워크 |
| `pytest-asyncio` | 비동기 테스트 지원 |

### 2. API 키 설정

```bash
cp config/.env.example config/.env
```

`config/.env` 파일을 열어 Upbit API 키를 입력한다:

```env
UPBIT_ACCESS_KEY=your_access_key_here
UPBIT_SECRET_KEY=your_secret_key_here
```

**Upbit API 키 발급 시 주의**:
- 자산조회, 주문조회, 주문하기 권한 모두 활성화
- 허용 IP를 반드시 설정 (보안)
- 출금 권한은 절대 부여하지 않을 것

### 3. 디렉토리 확인

`logs/`와 `data/` 디렉토리는 자동 생성되므로 별도 작업 불필요.

---

## 실행 방법

### Paper Trading (가상 매매)

API 키 없이도 실행 가능. 실제 시세를 기반으로 주문을 시뮬레이션한다.
**실전 투입 전 반드시 Paper 모드로 테스트할 것.**

```bash
python main.py --mode paper
```

- 초기 가상 잔고: 100,000 KRW
- 실제 주문을 전송하지 않음
- 현재가 도달 시 가상 체결 처리
- 로그에 `[PAPER]` 접두사 표시

### Live Trading (실전 매매)

```bash
python main.py --mode live
```

- `.env`에 유효한 API 키 필수
- 시작 시 설정값 자동 유효성 검사
- 실제 지정가 주문 전송
- `Ctrl+C`로 안전 종료 (진행 중 주문은 유지됨)

### 백테스트

과거 데이터로 전략 성능을 검증한다:

```bash
# 기본: KRW-BTC 90일, 잔고 10만원
python -m backtest.engine

# 커스텀 설정
python -m backtest.engine --market KRW-BTC --days 60 --balance 100000
```

**백테스트 출력 예시**:

```
=======================================================
  백테스트 결과 리포트
=======================================================
  마켓:       KRW-BTC
  기간:       2024-10-15 ~ 2025-01-13
  초기 잔고:        500,000 KRW
  최종 잔고:        527,340 KRW
-------------------------------------------------------
  총 수익:          +27,340 KRW (+5.47%)
  승률:               73.2%
  총 거래:              41건
  승/패:                30 / 11
  최대 낙폭:        28,500 KRW (5.70%)
  샤프비율:            1.42
=======================================================
```

---

## 설정값 가이드

모든 설정은 `config/settings.py`의 `TradingConfig` dataclass에서 관리한다.
코드를 수정하여 값을 바꾸거나, 추후 YAML/JSON 설정 파일 로드로 확장 가능하다.

### 전략 파라미터

| 설정 | 기본값 | 설명 | 조정 가이드 |
|------|--------|------|-------------|
| `grid_levels` | 4 | 그리드 단계 수 | 총 깊이 ~1.68%. 소액: 3~4, 대규모: 5~7 |
| `grid_spacing_atr_mult` | 5.0 | ATR 배수 (간격) | 1분봉 ATR 기준. 수수료 4.2배 커버 |
| `rsi_period` | 14 | RSI 계산 기간 | 1분봉 14분 lookback. 표준 스캘핑 설정 |
| `rsi_oversold` | 30.0 | 과매도 기준 | 1분봉에서 25 도달 극히 드묾. 30 적정 |
| `rsi_overbought` | 70.0 | 과매수 기준 | 높이면 청산 지연, 수익 기회 |
| `bb_period` | 20 | 볼린저밴드 기간 | 표준값 |
| `bb_std` | 2.0 | 볼린저밴드 표준편차 | 1분봉 노이즈 필터링. 2σ 표준 |
| `candle_unit` | 1 | 분봉 단위 | 1분봉 스캘핑 |
| `check_interval_sec` | 45 | 체크 간격 (초) | 캔들당 최소 1회 체크, API Rate Limit 안전 |

### 코인 선별 기준

| 설정 | 기본값 | 설명 |
|------|--------|------|
| `max_coins` | 1 | BTC 단일 운용 |
| `fixed_coins` | KRW-BTC | 고정 코인 |
| `min_volume_krw` | 10억 | 24h 최소 거래대금. 유동성 보장 |
| `max_daily_change` | 10% | 일일 변동률 상한. 초과 시 제외 |
| `max_spread_pct` | 0.3% | 호가 스프레드 상한. 체결 비용 제한 |
| `coin_reselect_hours` | 24 | 코인 재선별 주기 |

### 리스크 관리

| 설정 | 기본값 | 설명 | 중요도 |
|------|--------|------|--------|
| `max_per_coin_ratio` | 50% | 코인당 최대 투자 비율 | 높음 |
| `stop_loss_pct` | 1.5% | 그리드 하단 기준 손절 (스캘핑용) | 높음 |
| `max_drawdown_pct` | 10% | 총자산 드로다운 한도 (초과 시 전체 청산) | 최고 |
| `max_position_age_hours` | 2 | 포지션 최대 유지 시간 (120캔들) | 높음 |
| `min_order_krw` | 5,000 | 최소 주문금액 (Upbit 규정) | 고정 |

### 1분봉 스캘핑 최적화 요점

1. **그리드 4단계**: 총 깊이 ~1.68%. 1분봉에서 5레벨 2.1%는 과도
2. **BTC 단일 운용**: 유동성 최고, 스프레드 최소
3. **1분봉 + 45초 체크**: 캔들당 최소 1회 체크, API Rate Limit 안전
4. **수수료 4.2배 커버**: spacing 0.42% vs 왕복수수료 0.1%
5. **빠른 손절**: 1.5% 손절, 2시간 포지션 만료로 리스크 제한
6. **시장 체제 감지**: BB Width 0.5~2% 범위로 1분봉에 맞게 보정

---

## 아키텍처 상세

### 핵심 컴포넌트

#### API 클라이언트 (`core/api_client.py`)
- `httpx` 비동기 클라이언트 사용
- **Rate Limit 자동 관리**: 토큰 버킷 알고리즘
  - 시세 API: 초당 10회
  - 주문 API: 초당 8회
- 200개 초과 캔들 데이터 자동 페이징 (`get_candles_extended`)

#### 코인 선별 (`strategy/coin_selector.py`)
- KRW 마켓 전체 스캔 → 3단계 필터 → 스코어링
- 스코어 = 거래량(0.4) + 변동성 적정범위(0.4) + 스프레드(0.2)
- 변동성 3~7% 구간을 최적으로 평가 (그리드 전략에 적합한 범위)

#### 신호 엔진 (`strategy/signals.py`)
- 4개 지표 복합 평가: RSI, BB, Volume, MACD
- 각 조건에 가중치 부여 → 신뢰도 0.0~1.0 산출
- 신뢰도 0.6 미만은 실행하지 않음
- 포지션 사이징에 신뢰도 반영 (높을수록 더 많이 투자)

#### Adaptive Grid (`strategy/grid.py`)
- ATR × multiplier로 간격 산출
- **Upbit 호가 단위 자동 반올림** (200만원 이상 1,000원 단위 등)
- 최소 간격 = 수수료 × 3 (수수료 이하 간격 방지)
- ATR 20% 이상 변화 시 그리드 재설정

#### 모멘텀 전략 (`strategy/momentum.py`)
- RSI > 55 + 거래량 1.5배 조건으로 모멘텀 진입
- 트레일링 스톱 0.8% + ATR × 2.0 동적 스톱
- 하드 손절 1.2%, 최대 보유 15분
- RSI > 72 이익 실현, 가용잔고 20% 포지션

#### 주문 관리 (`trading/order_manager.py`)
- 그리드 레벨별 지정가 주문 일괄 등록
- 매수 체결 시 → 대응 매도 주문 자동 생성
- Paper 모드: 현재가 기반 가상 체결 시뮬레이션
- 긴급 매도: 시장가 주문으로 즉시 청산

#### 데이터베이스 (`data/database.py`)
- SQLite (aiosqlite 비동기)
- 테이블 4개: `trades`, `positions`, `grid_states`, `bot_state`
- 인덱스 자동 생성 (market, status)
- 거래 기록, 포지션 추적, 그리드 상태 영속화

---

## 메인 루프 흐름

```
main.py 시작
│
├─ 설정 검증 + DB 초기화
├─ 초기 잔고 기록
├─ 코인 선별 (24시간 주기)
│
└─ 반복 (45초마다) ──────────────────────────────────
   │
   ├─ 1. 잔고 확인 + 드로다운 체크
   │     └─ -10% 초과 → 전체 청산 후 봇 중지
   │
   ├─ 2. 코인 재선별 (24시간 경과 시)
   │
   ├─ 3. 데이터 수집 (1분봉 200개, 코인별 병렬)
   │
   ├─ 4. 코인별 처리 ─────────────────────────────
   │     │
   │     ├─ [그리드 있음]
   │     │   ├─ 주문 동기화 (체결 확인)
   │     │   ├─ 매수 체결 → 매도 주문 자동 생성
   │     │   ├─ 손절가 도달 → 청산
   │     │   ├─ ATR 20% 변화 → 그리드 재조정
   │     │   └─ RSI > 70 → 이익 실현
   │     │
   │     └─ [그리드 없음]
   │         ├─ 신호 생성 (RSI+BB+Vol+MACD)
   │         ├─ 신뢰도 0.6 이상 → 그리드 생성 + 매수
   │         └─ 미달 → HOLD (대기)
   │
   ├─ 5. 만료 포지션 정리 (2시간 초과)
   │
   └─ 6. 45초 대기
```

---

## 백테스트

### 동작 방식

1. Upbit API에서 과거 캔들 데이터 수집 (페이징)
2. 각 캔들마다 신호 확인 → 그리드 생성 → 체결 시뮬레이션
3. 고가/저가로 체결 여부 판단 (매수: 저가 <= 매수가, 매도: 고가 >= 매도가)
4. 수수료 0.05% 양방향 반영
5. 손절/드로다운 로직 동일 적용

### 결과 지표

| 지표 | 설명 |
|------|------|
| 승률 | 수익 거래 / 전체 거래 |
| 총 수익률 | (최종잔고 - 초기잔고) / 초기잔고 |
| 최대 낙폭 (MDD) | 고점 대비 최대 하락 비율 |
| 샤프 비율 | 위험 대비 수익 (1.0 이상 양호) |
| 평균 거래 손익 | 거래당 평균 KRW 손익 |

### 결과 해석 기준

- 승률 70% 이상: 목표 달성, 실전 투입 가능
- 승률 60~70%: 파라미터 미세 조정 권장
- 승률 60% 미만: 전략 파라미터 또는 코인 선별 재검토
- MDD 10% 초과: 리스크 설정 강화 필요

---

## 테스트

```bash
# 전체 테스트 실행
python -m pytest tests/ -v

# 특정 모듈만
python -m pytest tests/test_grid.py -v

# 커버리지 포함 (pytest-cov 설치 필요)
python -m pytest tests/ --cov=strategy --cov=trading --cov-report=term
```

**현재 테스트 현황**: 62개 전부 통과

| 테스트 파일 | 케이스 수 | 검증 대상 |
|-------------|-----------|-----------|
| `test_indicators.py` | 11 | RSI 범위/과매도/과매수, BB 정렬, ATR 양수/변동성, MACD |
| `test_grid.py` | 10 | 레벨 수, 매수<현재가, 매도>매수, 손절가, 최소간격, 직렬화, 호가단위 |
| `test_risk_manager.py` | 14 | 포지션사이징, 드로다운 한도, 손절, 포지션 유효기간, 주문 검증 |
| `test_backtest.py` | 7 | 기본 실행, 빈 데이터, 수수료, MDD 한도, 승률, 고/저 변동성 |
| `test_momentum.py` | 20 | 포지션 생성, 트레일링 스톱, 청산 조건, PnL, 직렬화 |

---

## 로그 및 모니터링

### 로그 파일 위치

```
logs/
├── bot_2025-01-15.log       # 전체 로그 (DEBUG 이상, 30일 보관)
└── trades_2025-01-15.log    # 거래 전용 로그 (INFO 이상, 90일 보관)
```

### 로그 포맷

**콘솔** (간결):
```
14:30:15 | INFO    | 매수 신호 | KRW-BTC | 신뢰도: 0.82 | 이유: RSI 과매도: 24.3, BB 하단 이탈
14:30:16 | INFO    | 매수 주문 | KRW-BTC L1 | 가격: 89,000,000 | 수량: 0.00026966
```

**파일** (상세):
```
2025-01-15 14:30:15.234 | INFO    | strategy.signals:generate_signal:95 | 매수 신호 생성
```

**거래 전용**:
```
2025-01-15 14:30:16 | 매수 주문 | KRW-BTC L1 | 가격: 89,000,000 | 수량: 0.00026966
2025-01-15 14:45:02 | 매도 체결 | KRW-BTC L1 | 가격: 90,000,000
```

### 모니터링 체크포인트

- `logs/trades_*.log`: 실시간 체결 내역 확인
- SQLite DB (`data/trades.db`): 전체 거래 이력 쿼리 가능
- 콘솔 출력: 매 루프마다 포트폴리오 요약 출력 (Live 모드)

---

## 운영 가이드

### 실전 투입 전 체크리스트

1. 백테스트 실행 → 승률 70% 이상, MDD 10% 이하 확인
2. Paper 모드 1주일 이상 운영
3. Paper 결과와 백테스트 결과 비교
4. API 키 허용 IP 설정 확인
5. 소액(5만원)으로 Live 시작
6. 1주일간 모니터링 후 증액

### 안전 종료

- `Ctrl+C` 입력 시 현재 루프 완료 후 안전 종료
- 미체결 주문은 Upbit에 남아있음 → 필요 시 수동 취소
- DB에 마지막 상태 저장됨

### 서버 운영 (24시간)

```bash
# nohup으로 백그라운드 실행
nohup python main.py --mode live > /dev/null 2>&1 &

# 또는 systemd 서비스로 등록
# 또는 screen/tmux 세션 사용
```

### 문제 발생 시

| 상황 | 봇 동작 | 확인 사항 |
|------|---------|-----------|
| API 연결 실패 | 5초 후 재시도 | 네트워크, API 키 확인 |
| 드로다운 -10% | 전체 청산 + 봇 중지 | `logs/` 확인 후 원인 분석 |
| 주문 실패 | 로그 기록 후 다음 루프 | 잔고, 최소주문금액 확인 |
| 코인 선별 0개 | 대기 상태 | 시장 상황 확인 (전체 급등/급락 시 가능) |

---

## 업그레이드 로드맵

### Phase A: 단기 개선 (1~2주)

#### A1. 텔레그램 알림 연동
현재 `utils/notifier.py`가 콘솔 출력만 하므로, 텔레그램 봇 연동 추가.
- `python-telegram-bot` 패키지 추가
- 거래 체결, 손절, 드로다운 경고를 실시간 푸시
- 일일 P&L 리포트 자동 전송
- `.env`에 `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID` 추가

#### A2. 설정 외부화 (YAML/JSON)
현재 `settings.py` dataclass 직접 수정 방식 → YAML 파일 로드로 전환.
- 코드 수정 없이 전략 파라미터 변경 가능
- 여러 설정 프로필 지원 (`config/aggressive.yaml`, `config/conservative.yaml`)
- 커맨드라인에서 `--config config/my_settings.yaml` 지정

#### A3. Paper 모드 잔고 시뮬레이션 강화
현재 Paper 모드는 고정 50만원 가상잔고. 개선:
- 가상 잔고 차감/증가 로직 추가
- 체결 시 수수료 반영
- Paper 결과를 DB에 저장하여 성과 추적

### Phase B: 중기 고도화 (1~2개월)

#### B1. 다중 타임프레임 분석 (MTF)
현재 15분봉 단일 타임프레임. 개선:
- 1시간봉/4시간봉 추세 확인 → 진입 필터 강화
- 상위 타임프레임 하락 추세 시 진입 제한
- 예상 승률 5~10% 추가 향상

#### B2. 동적 파라미터 조정
시장 상태(횡보/상승/하락)를 자동 감지하여 파라미터 조정:
- ADX(Average Directional Index)로 추세 강도 측정
- 횡보장: 그리드 간격 축소, 레벨 증가
- 추세장: 그리드 간격 확대, 진입 조건 강화
- 급락장: 매수 중지

#### B3. WebSocket 실시간 체결 감지
현재 1분 폴링 방식을 WebSocket 실시간 방식으로 전환:
- `core/websocket_client.py`를 메인 루프에 통합
- 가격 변동 즉시 그리드 체결 확인
- 급변 시 빠른 손절 대응 (현재 최대 60초 지연)

#### B4. 백테스트 시각화
`matplotlib` 또는 `plotly`로 백테스트 결과 차트:
- 자산 곡선 (equity curve)
- 그리드 진입/청산 포인트 표시
- 드로다운 구간 시각화
- 월별/주별 수익률 히트맵

#### B5. 성과 대시보드
웹 기반 실시간 대시보드:
- `FastAPI` + `htmx` 또는 `Streamlit`
- 현재 포지션, 그리드 상태, P&L 실시간 표시
- 거래 이력 테이블
- 일일/주간/월간 성과 그래프

### Phase C: 장기 확장 (3개월+)

#### C1. 멀티 전략 엔진
Grid + Mean Reversion 외 추가 전략 지원:
- Breakout 전략 (추세장 대응)
- DCA (Dollar Cost Averaging) 전략
- 전략별 독립 포트폴리오 관리
- 시장 상태에 따라 전략 자동 전환

#### C2. 머신러닝 신호 보강
기존 규칙 기반 신호에 ML 모델 보강:
- LSTM/Transformer 기반 가격 변동 예측
- 최적 그리드 간격 학습
- 코인 선별 스코어링 모델
- 주의: 과적합 방지를 위한 엄격한 백테스트 필수

#### C3. 거래소 확장
Upbit 외 거래소 지원:
- Binance, Bithumb 등
- 거래소 추상화 인터페이스 설계
- 거래소 간 아비트라지 가능성

#### C4. 리스크 모델 고도화
- Value at Risk (VaR) 계산
- 포트폴리오 상관관계 분석
- Kelly Criterion 기반 포지션사이징
- 시장 변동성 레짐(regime) 감지

#### C5. 분산 실행 아키텍처
대규모 운용 시:
- Redis 기반 상태 공유
- 전략 엔진 / 주문 실행 / 모니터링 프로세스 분리
- Docker Compose로 통합 배포
- Prometheus + Grafana 메트릭 모니터링

### 업그레이드 우선순위 권장

```
즉시 적용 가능 → A1 (텔레그램), A2 (YAML 설정), A3 (Paper 강화)
        ↓
승률 개선 효과 → B1 (다중 타임프레임), B2 (동적 파라미터)
        ↓
운영 편의성   → B3 (WebSocket), B4 (시각화), B5 (대시보드)
        ↓
장기 투자     → C1~C5 (멀티전략, ML, 거래소 확장)
```

---

## 알려진 한계

### 전략 한계
- **횡보장 의존**: 강한 일방향 추세에서는 그리드 전체가 손절될 수 있음
- **소액 제약**: Upbit 최소주문 5,000원으로 그리드 레벨 수가 제한됨
- **슬리피지 미반영**: 백테스트에서 시장가 슬리피지를 고려하지 않음 (소액이므로 영향 미미)

### 기술적 한계
- **폴링 방식**: 현재 45초 간격 폴링. 급변 시 최대 45초 지연
- **단일 프로세스**: 봇이 종료되면 미체결 주문이 Upbit에 남아있음
- **Paper 모드**: 호가 깊이, 체결 우선순위 등은 시뮬레이션하지 않음

### 시장 리스크
- **블랙스완**: 시장 급변(거래소 해킹, 규제 등)은 손절로도 방어 불가
- **유동성 리스크**: 거래량 급감 시 지정가 주문 미체결 가능
- **수수료 변경**: Upbit 수수료율 변경 시 그리드 간격 재검토 필요

---

## 라이선스

개인 사용 목적. 투자 손실에 대한 책임은 사용자에게 있습니다.
자동매매 봇 사용 시 반드시 소액으로 충분한 테스트를 거친 후 운용하세요.
